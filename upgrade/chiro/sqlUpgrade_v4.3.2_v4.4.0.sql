-- Modifications des données de la bdd

UPDATE `system` SET `value`='v4.4.0' WHERE `name`='chiro';

UPDATE forms set javascript = '$(document).ready(function() {\r\n\r\n  //calcul IMC\r\n  if ($(\'#id_imc_id\').length > 0) {\r\n\r\n    imc = imcCalc($(\'#id_poids_id\').val(), $(\'#id_taillePatient_id\').val());\r\n    if (imc > 0) {\r\n      $(\'#id_imc_id\').val(imc);\r\n    }\r\n\r\n    $(\"#patientLatCol\").on(\"keyup\", \"#id_poids_id , #id_taillePatient_id\", function() {\r\n      poids = $(\'#id_poids_id\').val();\r\n      taille = $(\'#id_taillePatient_id\').val();\r\n      imc = imcCalc(poids, taille);\r\n      $(\'#id_imc_id\').val(imc);\r\n      patientID = $(\'#identitePatient\').attr(\"data-patientID\");\r\n      setPeopleDataByTypeName(imc, patientID, \'imc\', \'#id_imc_id\', \'0\');\r\n\r\n    });\r\n  }\r\n\r\n  //autoresize\r\n  autosize($(\'#formName_chiroATCD textarea\'));\r\n\r\n});' where internalName = 'chiroATCD';
UPDATE forms set javascript = '$(document).ready(function() {\r\n\r\n  $(document).scroll(function(e){\r\n    if ($(\"#svgparent\").length)\r\n      $(\".tools\").css(\"top\", Math.min($(\"#svgparent\").height()-$(\".tools\").height()+20, Math.max(0, e.pageY+60-$(\"#svgparent\").offset().top)));\r\n  });\r\n\r\n  $(\"body\").on(\"touchstart\", \"#skeleton\", function(e){\r\n    if(e.touches.length>1)\r\n      e.stopPropagation();\r\n  });\r\n\r\n  $(\"body\").on(\"touchstart\", \"path,g,div,svg,form\", function(e){\r\n    if(e.touches.length > 1)\r\n      e.preventDefault();\r\n  });\r\n\r\n  $(\"body\").on(\"touchmove\", \"path,g,div,svg,form\", function(e){\r\n    if(e.touches.length > 1)\r\n      e.preventDefault();\r\n  });\r\n\r\n  $(\"body\").on(\"mousedown\", \".showAll\", function(){\r\n    $(\".os:not(.show),.articulation:not(.show)\").each(function(idx,el){el.className.baseVal+=\" show\"})\r\n  });\r\n  $(\"body\").on(\"mouseup\", \".showAll\", function(){\r\n    $(\".selectable,.os,.articulation\").each(function(idx,el){el.className.baseVal=el.className.baseVal.replace(\" show\", \"\")})\r\n  });\r\n\r\n  $(\"body\").on(\"click\", \".zoomFit\", function(){\r\n    svgFit(true);\r\n  });\r\n  $(window).on(\"resize\", function(){\r\n    svgFit(true);\r\n  });\r\n\r\n  $(\"body\").on(\"click\", \".menuSingle\", function (e) {\r\n    var $menu = $(\".svgMenuSingle\")\r\n      .show()\r\n      .css({left: Math.max(0, e.pageX-50), top: Math.max(0, e.pageY-50)})\r\n      .off(\'click\')\r\n      .on(\"mouseleave\", function(){\r\n        $(this).hide()\r\n        .children(\"li:nth-child(n+3)\").remove();\r\n      })\r\n      .on(\'click\', \'a\', function (e) {\r\n        e.stopImmediatePropagation();\r\n        var chk = $(this).children(\"input\").prop(\"checked\");\r\n        $(this).parent().parent().find(\"input\").prop(\"checked\", false);\r\n        $(this).children(\"input\").prop(\"checked\", !chk);\r\n        //on fixe la valeur de l\'entrée de formulaire\r\n        var $entry = $(\"input[placeholder=\'\"+$(this).attr(\'data-entry\')+\"\']\");\r\n        var value = $(this).attr(\'data-value\');\r\n        if (chk)\r\n          $entry.attr(\"value\", \"\");\r\n        else\r\n          $entry.attr(\"value\", value);\r\n        setChiroSelected($(this).attr(\'data-entry\'));\r\n      });\r\n    var title = $(this).attr(\"value\");\r\n    var items = $(this).attr(\"menu\").split(\",\");\r\n    $menu.children().first().html(title);\r\n    for (var i=0; i< items.length; i++)\r\n      $menu.append(\'<li><a tabindex=\"-1\" style=\"text-decoration:none;color:#484848\" class=\"containerCheck\" data-entry=\"\'+title\r\n      + \'\" data-value=\"\' +items[i]+\r\n      \'\">\'+items[i]+\'<input type=\"radio\"\'+($(\"input[placeholder=\'\"+title+\"\']\").attr(\"value\") == items[i] ? \' checked\' : \'\')+\r\n      \'></input><span class=\"checkmarkRadio\"></span></a></li>\');\r\n    return false;\r\n  });\r\n\r\n  $(\"body\").on(\"click\", \".menuMulti\", function (e) {\r\n    var $menu = $(\".svgMenuMulti\")\r\n      .show()\r\n      .css({left: Math.max(0, e.pageX-50), top: Math.max(0, e.pageY-50)})\r\n      .off(\'click\')\r\n      .on(\"mouseleave\", function(){\r\n        $(this).hide()\r\n        .children(\"li:nth-child(n+3)\").remove();\r\n      })\r\n      .on(\'click\', \'a\', function (e) {\r\n        e.stopImmediatePropagation();\r\n        var chk = $(this).children(\"input\").attr(\"checked\");\r\n        if (chk)\r\n          $(this).children(\"input\").removeAttr(\"checked\");\r\n        else\r\n          $(this).children(\"input\").attr(\"checked\",\"\");\r\n        //on fixe la valeur de l\'entrée de formulaire\r\n        var $entry = $(\"input[placeholder=\'\"+$(this).attr(\'data-entry\')+\"\']\");\r\n        var value = $entry.attr(\"value\");\r\n        var newValue = $(this).attr(\'data-value\');\r\n        var idx;\r\n        if (value && (idx=value.split(\",\").findIndex(function(v){return v==newValue})) >= 0)\r\n          $entry.attr(\"value\",value.split(\",\").filter(function(v,i){return i!=idx}).join());\r\n        else if (value && value != \"\")\r\n          $entry.attr(\"value\", value + \",\" + newValue);\r\n        else\r\n          $entry.attr(\"value\", newValue);\r\n        setChiroSelected($(this).attr(\'data-entry\'));\r\n      });\r\n    var title = $(this).attr(\"value\");\r\n    var items = $(this).attr(\"menu\").split(\",\");\r\n    var value = $(\"input[placeholder=\'\"+title+\"\']\").attr(\"value\");\r\n    $menu.children().first().html(title);\r\n    for (var i=0; i< items.length; i++)\r\n      $menu.append(\'<li><a tabindex=\"-1\" style=\"text-decoration:none;color:#484848\" class=\"containerCheck\" data-entry=\"\'+title\r\n      + \'\" data-value=\"\' +items[i]+\r\n      \'\">\'+items[i]+\'<input type=\"checkbox\"\'+ ((value && value.split(\",\").findIndex(function(v){return v==items[i]}) >= 0) ? \' checked\' : \'\')+\r\n      \'></input><span class=\"checkmarkCheck\"></span></a></li>\');\r\n    return false;\r\n  });\r\n\r\n  $(\"body\").on(\"click\", function(){\r\n    $(\".svgMenuSingle,.svgMenuMulti\").hide().children(\"li:nth-child(n+3)\").remove();\r\n  });\r\n\r\n  $(\"body\").on(\"click\", \".noMenu\", function(e){\r\n    e.stopImmediatePropagation();\r\n    var $entry = $(\"input[placeholder=\'\"+$(this).attr(\"value\")+\"\']\");\r\n    if ($entry.attr(\"value\") == \"true\")\r\n      $entry.attr(\"value\", \"\");\r\n    else\r\n      $entry.attr(\"value\", \"true\");\r\n    setChiroSelected($(this).attr(\"value\"));\r\n  });  \r\n\r\n  $(\"body\").on(\"mouseenter\", \".os,.articulation\", function(e){\r\n      this.className.baseVal+=\" show\";\r\n      $(\"#mousehelper\").html($(this).attr(\"value\"))\r\n      .removeClass(\"hide\").css(\"left\", (e.pageX-100)+\"px\").css(\"top\", (e.pageY-50)+\"px\");\r\n  });\r\n\r\n  $(\"body\").on(\"mouseleave\", \".show\", function(){\r\n    this.className.baseVal=this.className.baseVal.replace(\" show\", \"\");\r\n    $(\"#mousehelper:not(.hide)\").html(\"\").addClass(\"hide\");\r\n  });\r\n\r\n});' where internalName =  'chiroConsult';
